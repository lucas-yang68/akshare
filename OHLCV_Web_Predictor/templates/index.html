<!DOCTYPE html>
<html>
<head>
  <title>OHLCV 下一周期预测</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="text-center mb-4">股票下一周期上涨概率预测</h2>
  <div class="row g-3">
    <div class="col-md-3">
      <input type="text" id="code" class="form-control" placeholder="股票代码（如 600519）">
    </div>
    <div class="col-md-3">
      <input type="date" id="start" class="form-control">
    </div>
    <div class="col-md-3">
      <input type="date" id="end" class="form-control">
    </div>
    <div class="col-md-3">
      <input type="date" id="eval" class="form-control">
    </div>
  </div>
  <div class="text-center mt-3">
    <button onclick="predict()" class="btn btn-primary">预测上涨概率</button>
  </div>
  <div id="result" class="mt-4 text-center"></div>
</div>

<script>
function predict() {
  const data = {
    code: document.getElementById('code').value,
    start: document.getElementById('start').value,
    end: document.getElementById('end').value,
    eval_date: document.getElementById('eval').value
  };
  
  fetch('/predict', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  })
  .then(r => r.json())
  .then(res => {
    const div = document.getElementById('result');
    if (res.success) {
      const info = res.model_info;
      div.innerHTML = `
        <div class="alert alert-info">
          <strong>模型训练完成</strong><br>
          训练集: ${info.train_size} 条 | 测试集: ${info.test_size} 条<br>
          准确率: ${info.accuracy}% | AUC: ${info.auc}
        </div>
        <h3 style="color:green">上涨概率: ${res.probability}%</h3>
        <p>${res.message}</p>
      `;
    } else {
      div.innerHTML = `<p style="color:red">错误: ${res.message}</p>`;
    }
  });
}
</script>
</body>
</html>

